# üêõ Bugfix: Inline-–∫–Ω–æ–ø–∫–∏ –ù–µ –†–∞–±–æ—Ç–∞—é—Ç

**–í–µ—Ä—Å–∏—è:** 2.4.1 ‚Üí 2.4.2
**–î–∞—Ç–∞:** 2025-10-25
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û**

---

## üìã –ü—Ä–æ–±–ª–µ–º–∞

### –û–ø–∏—Å–∞–Ω–∏–µ:

–í—Å–µ Inline-–∫–Ω–æ–ø–∫–∏ –≤ –±–æ—Ç–µ **–ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è**, –Ω–æ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ **–Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
- –ö–Ω–æ–ø–∫–∏ –º–µ–Ω—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ (`üìà Digital-–º–∞—Ä–∫–µ—Ç–∏–Ω–≥`, `üé® –ì—Ä–∞—Ñ–∏–∫–∞ –∏ AI`, `üöÄ –≠–∫—Å–ø—Ä–µ—Å—Å-–∑–∞–∫–∞–∑—ã`) –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç
- –ö–Ω–æ–ø–∫–∏ –≤–æ—Ä–æ–Ω–∫–∏ (`üìà –ü—Ä–∏–≤–ª–µ—á—å –∫–ª–∏–µ–Ω—Ç–æ–≤`, `ü§ñ AI-–≤–∏–¥–µ–æ`, `üíª –°–∞–π—Ç / –õ–µ–Ω–¥–∏–Ω–≥`) –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç
- "–ß–∞—Å–∏–∫–∏" –Ω–∞ –∫–Ω–æ–ø–∫–∞—Ö –Ω–µ –ø—Ä–æ–ø–∞–¥–∞—é—Ç
- –ë–æ—Ç –Ω–µ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –Ω–∞–∂–∞—Ç–∏—è

### –ö–æ—Ä–µ–Ω—å –ü—Ä–æ–±–ª–µ–º—ã:

–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ callback –±—ã–ª–∏ **–ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º FSM**:

```python
@router.callback_query(FunnelStates.choosing_direction)  # ‚Üê –¢—Ä–µ–±—É–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ!
async def handle_direction_choice(callback: CallbackQuery, state: FSMContext, bot: Bot):
    ...

@router.callback_query(FunnelStates.step1_qualification)  # ‚Üê –¢—Ä–µ–±—É–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ!
async def handle_step1_choice(callback: CallbackQuery, state: FSMContext, bot: Bot):
    ...
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ **–Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ** –∏–ª–∏ **–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ**, –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ **–Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç**!

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –î–æ–±–∞–≤–ª–µ–Ω—ã –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏

–°–æ–∑–¥–∞–Ω—ã **–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ë–ï–ó —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—é**, –∫–æ—Ç–æ—Ä—ã–µ –ª–æ–≤—è—Ç –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫–∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç FSM state.

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `packages/core/handlers/callbacks.py`

#### 1. –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è Navigation (Fallback Menu)

**–§–∞–π–ª:** `packages/core/handlers/callbacks.py` (—Å—Ç—Ä–æ–∫–∏ 20-48)

```python
# –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–´–ô –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –í–°–ï–• callback (–±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—é)
@router.callback_query(F.data.startswith("select_"))
async def handle_navigation_fallback(callback: CallbackQuery, state: FSMContext, bot: Bot):
    """
    –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ (fallback menu)
    –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è FSM
    """
    callback_data = callback.data

    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å –Ω–∞ –æ—Å–Ω–æ–≤–µ callback_data
    profile_map = {
        "select_agency": "agency",
        "select_cg": "cg",
        "select_express": "express",
    }

    profile_name = profile_map.get(callback_data)
    if not profile_name:
        await callback.answer("–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –≤—ã–±–æ—Ä")
        return

    # –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º –Ω–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ (—É–±–∏—Ä–∞–µ–º "—á–∞—Å–∏–∫–∏")
    await callback.answer()

    logger.info(f"üîò Fallback navigation: –≤—ã–±—Ä–∞–Ω –ø—Ä–æ—Ñ–∏–ª—å {profile_name}")

    # –ó–∞–ø—É—Å–∫–∞–µ–º –≤–æ—Ä–æ–Ω–∫—É –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è
    await start_funnel(callback.message, state, profile_name, bot)
```

**–ß—Ç–æ –ª–æ–≤–∏—Ç:**
- `select_agency` ‚Üí Monster Agency
- `select_cg` ‚Üí Monster CG
- `select_express` ‚Üí Monster Express

---

#### 2. –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è Funnel Choices

**–§–∞–π–ª:** `packages/core/handlers/callbacks.py` (—Å—Ç—Ä–æ–∫–∏ 77-163)

```python
# –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–´–ô –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –≤–æ—Ä–æ–Ω–∫–∏ (agency_*, cg_*, express_*)
@router.callback_query(
    F.data.startswith("agency_") |
    F.data.startswith("cg_") |
    F.data.startswith("express_")
)
async def handle_funnel_choice_fallback(callback: CallbackQuery, state: FSMContext, bot: Bot):
    """
    –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –≤–æ—Ä–æ–Ω–∫–∏
    –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è FSM
    """
    callback_data = callback.data

    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å –∏–∑ callback_data
    if callback_data.startswith("agency_"):
        profile_name = "agency"
    elif callback_data.startswith("cg_"):
        profile_name = "cg"
    elif callback_data.startswith("express_"):
        profile_name = "express"
    else:
        await callback.answer("–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –≤—ã–±–æ—Ä")
        return

    # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–π –æ–ø—Ü–∏–∏
    choice_text = locale_manager.get_choice_text(profile_name, callback_data)

    # –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º –Ω–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ (—É–±–∏—Ä–∞–µ–º "—á–∞—Å–∏–∫–∏")
    await callback.answer("‚úÖ –í—ã–±–æ—Ä –ø—Ä–∏–Ω—è—Ç!")

    logger.info(f"üîò Funnel choice (fallback): –ø—Ä–æ—Ñ–∏–ª—å={profile_name}, –≤—ã–±–æ—Ä={choice_text}")

    # –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –∫–æ–Ω—Ç–∞–∫—Ç
    # ... (—Å–º. –ø–æ–ª–Ω—ã–π –∫–æ–¥ –≤ —Ñ–∞–π–ª–µ)

    # –ü–µ—Ä–µ–≤–æ–¥–∏–º –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–∞
    await state.set_state(FunnelStates.step2_waiting_contact)
```

**–ß—Ç–æ –ª–æ–≤–∏—Ç:**
- `agency_attract`, `agency_sales`, `agency_ads` ‚Üí Monster Agency
- `cg_ai`, `cg_vfx`, `cg_cgi` ‚Üí Monster CG
- `express_site`, `express_banner`, `express_ai` ‚Üí Monster Express

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: Fallback Menu (Navigation)

**–®–∞–≥–∏:**
```
1. –û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞: https://t.me/monstrassistentbot
2. –ö–æ–º–∞–Ω–¥–∞: /start (–±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤)
3. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É: "üìà Digital-–º–∞—Ä–∫–µ—Ç–∏–Ω–≥"
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ "–ß–∞—Å–∏–∫–∏" –Ω–∞ –∫–Ω–æ–ø–∫–µ **–ø—Ä–æ–ø–∞–¥–∞—é—Ç** (callback.answer() —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç)
- ‚úÖ –ë–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–æ—Ä–æ–Ω–∫—É Agency —Å —Ñ–æ—Ç–æ
- ‚úÖ –¢—Ä–∏ –∫–Ω–æ–ø–∫–∏: "üìà –ü—Ä–∏–≤–ª–µ—á—å –∫–ª–∏–µ–Ω—Ç–æ–≤", "üí∞ –£–≤–µ–ª–∏—á–∏—Ç—å –ø—Ä–æ–¥–∞–∂–∏", "üéØ –£–ª—É—á—à–∏—Ç—å —Ä–µ–∫–ª–∞–º—É"
- ‚úÖ –í –ª–æ–≥–∞—Ö: `üîò Fallback navigation: –≤—ã–±—Ä–∞–Ω –ø—Ä–æ—Ñ–∏–ª—å agency`

---

### –¢–µ—Å—Ç 2: Funnel Choices (–í–æ—Ä–æ–Ω–∫–∞ Agency)

**–®–∞–≥–∏:**
```
1. –û—Ç–∫—Ä–æ–π—Ç–µ: https://t.me/monstrassistentbot?start=agency
2. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É: "üìà –ü—Ä–∏–≤–ª–µ—á—å –∫–ª–∏–µ–Ω—Ç–æ–≤"
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ "–ß–∞—Å–∏–∫–∏" –Ω–∞ –∫–Ω–æ–ø–∫–µ **–ø—Ä–æ–ø–∞–¥–∞—é—Ç**
- ‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç—Å—è: "‚úÖ –ü—Ä–∏–Ω—è—Ç–æ: –ü—Ä–∏–≤–ª–µ—á—å –∫–ª–∏–µ–Ω—Ç–æ–≤. –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –∫–æ–Ω—Ç–∞–∫—Ç–æ–º üëá"
- ‚úÖ –ü–æ—è–≤–ª—è–µ—Ç—Å—è Reply-–∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞: `[üë§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–º]`
- ‚úÖ –í –ª–æ–≥–∞—Ö: `üîò Funnel choice (fallback): –ø—Ä–æ—Ñ–∏–ª—å=agency, –≤—ã–±–æ—Ä=–ü—Ä–∏–≤–ª–µ—á—å –∫–ª–∏–µ–Ω—Ç–æ–≤`

---

### –¢–µ—Å—Ç 3: Funnel Choices (–í–æ—Ä–æ–Ω–∫–∞ CG)

**–®–∞–≥–∏:**
```
1. –û—Ç–∫—Ä–æ–π—Ç–µ: https://t.me/monstrassistentbot?start=cg
2. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É: "ü§ñ AI-–≤–∏–¥–µ–æ"
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ "–ß–∞—Å–∏–∫–∏" –ø—Ä–æ–ø–∞–¥–∞—é—Ç
- ‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç—Å—è: "‚úÖ –ü—Ä–∏–Ω—è—Ç–æ: AI-–≤–∏–¥–µ–æ. –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –∫–æ–Ω—Ç–∞–∫—Ç–æ–º üëá"
- ‚úÖ Reply-–∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è
- ‚úÖ –í –ª–æ–≥–∞—Ö: `üîò Funnel choice (fallback): –ø—Ä–æ—Ñ–∏–ª—å=cg, –≤—ã–±–æ—Ä=AI-–≤–∏–¥–µ–æ`

---

### –¢–µ—Å—Ç 4: Funnel Choices (–í–æ—Ä–æ–Ω–∫–∞ Express)

**–®–∞–≥–∏:**
```
1. –û—Ç–∫—Ä–æ–π—Ç–µ: https://t.me/monstrassistentbot?start=express
2. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É: "üíª –°–∞–π—Ç / –õ–µ–Ω–¥–∏–Ω–≥"
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ "–ß–∞—Å–∏–∫–∏" –ø—Ä–æ–ø–∞–¥–∞—é—Ç
- ‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç—Å—è: "‚úÖ –ü—Ä–∏–Ω—è—Ç–æ: –°–∞–π—Ç / –õ–µ–Ω–¥–∏–Ω–≥. –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –∫–æ–Ω—Ç–∞–∫—Ç–æ–º üëá"
- ‚úÖ Reply-–∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è
- ‚úÖ –í –ª–æ–≥–∞—Ö: `üîò Funnel choice (fallback): –ø—Ä–æ—Ñ–∏–ª—å=express, –≤—ã–±–æ—Ä=–°–∞–π—Ç / –õ–µ–Ω–¥–∏–Ω–≥`

---

## üìä –î–∏–∞–≥—Ä–∞–º–º–∞ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –î–æ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–û–®–ò–ë–ö–ê):

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É
    ‚Üì
Telegram –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç callback_query
    ‚Üì
Dispatcher –∏—â–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
    ‚Üì
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ FSM
    ‚Üì
‚ùå –°–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!
    ‚Üì
‚ùå –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ù–ï —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç
    ‚Üì
‚ùå "–ß–∞—Å–∏–∫–∏" –æ—Å—Ç–∞—é—Ç—Å—è, –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç
```

---

### –ü–æ—Å–ª–µ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–ü–†–ê–í–ò–õ–¨–ù–û):

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É
    ‚Üì
Telegram –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç callback_query
    ‚Üì
Dispatcher –∏—â–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
    ‚Üì
‚úÖ –ù–∞—Ö–æ–¥–∏—Ç –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–´–ô –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
   (F.data.startswith("select_") –ò–õ–ò F.data.startswith("agency_"))
    ‚Üì
‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ë–ï–ó –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    ‚Üì
‚úÖ await callback.answer() ‚Üí "–ß–∞—Å–∏–∫–∏" –ø—Ä–æ–ø–∞–¥–∞—é—Ç
    ‚Üì
‚úÖ –õ–æ–≥–∏–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è (–∑–∞–ø—É—Å–∫ –≤–æ—Ä–æ–Ω–∫–∏ –∏–ª–∏ –∑–∞–ø—Ä–æ—Å –∫–æ–Ω—Ç–∞–∫—Ç–∞)
    ‚Üì
‚úÖ –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç!
```

---

## üîç –õ–æ–≥–∏

### –î–æ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–ù–ï–¢ –õ–û–ì–û–í):

```
2025-10-25 18:00:00 - INFO - üöÄ Monster Triborg Bot –∑–∞–ø—É—â–µ–Ω!
2025-10-25 18:00:05 - INFO - Run polling for bot @monstrassistentbot

[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É]
[–ù–ï–¢ –õ–û–ì–û–í - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª]
```

---

### –ü–æ—Å–ª–µ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–ï–°–¢–¨ –õ–û–ì–ò):

```
2025-10-25 18:24:09 - INFO - üöÄ Monster Triborg Bot –∑–∞–ø—É—â–µ–Ω!
2025-10-25 18:24:10 - INFO - Run polling for bot @monstrassistentbot

[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "üìà Digital-–º–∞—Ä–∫–µ—Ç–∏–Ω–≥"]
2025-10-25 18:24:15 - INFO - üîò Fallback navigation: –≤—ã–±—Ä–∞–Ω –ø—Ä–æ—Ñ–∏–ª—å agency

[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "üìà –ü—Ä–∏–≤–ª–µ—á—å –∫–ª–∏–µ–Ω—Ç–æ–≤"]
2025-10-25 18:24:20 - INFO - üîò Funnel choice (fallback): –ø—Ä–æ—Ñ–∏–ª—å=agency, –≤—ã–±–æ—Ä=–ü—Ä–∏–≤–ª–µ—á—å –∫–ª–∏–µ–Ω—Ç–æ–≤
```

---

## üìù –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ –§–∞–π–ª—ã

| –§–∞–π–ª | –°—Ç—Ä–æ–∫–∏ | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|------|--------|-----------|
| `packages/core/handlers/callbacks.py` | 20-48 | –î–æ–±–∞–≤–ª–µ–Ω `handle_navigation_fallback` |
| `packages/core/handlers/callbacks.py` | 77-163 | –î–æ–±–∞–≤–ª–µ–Ω `handle_funnel_choice_fallback` |

---

## üéØ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –£—Å–ø–µ—Ö–∞

- [x] –í—Å–µ Inline-–∫–Ω–æ–ø–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- [x] "–ß–∞—Å–∏–∫–∏" –ø—Ä–æ–ø–∞–¥–∞—é—Ç –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏
- [x] Fallback menu –∑–∞–ø—É—Å–∫–∞–µ—Ç –≤–æ—Ä–æ–Ω–∫–∏
- [x] –ö–Ω–æ–ø–∫–∏ –≤–æ—Ä–æ–Ω–∫–∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç –∫–æ–Ω—Ç–∞–∫—Ç
- [x] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç FSM state

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –§–∏–ª—å—Ç—Ä—ã:

| –§–∏–ª—å—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|--------|----------|--------|
| `F.data.startswith("select_")` | –õ–æ–≤–∏—Ç –∫–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ | `select_agency` |
| `F.data.startswith("agency_")` | –õ–æ–≤–∏—Ç –∫–Ω–æ–ø–∫–∏ Agency | `agency_attract` |
| `F.data.startswith("cg_")` | –õ–æ–≤–∏—Ç –∫–Ω–æ–ø–∫–∏ CG | `cg_ai` |
| `F.data.startswith("express_")` | –õ–æ–≤–∏—Ç –∫–Ω–æ–ø–∫–∏ Express | `express_site` |

### –õ–æ–≥–∏–∫–∞ OR (|):

```python
@router.callback_query(
    F.data.startswith("agency_") |     # –ò–õ–ò
    F.data.startswith("cg_") |         # –ò–õ–ò
    F.data.startswith("express_")      # –ò–õ–ò
)
```

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç, –µ—Å–ª–∏ `callback_data` –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å **–ª—é–±–æ–≥–æ** –∏–∑ —ç—Ç–∏—Ö –ø—Ä–µ—Ñ–∏–∫—Å–æ–≤.

---

## üöÄ –î–µ–ø–ª–æ–π

**–î–∞—Ç–∞:** 2025-10-25
**–í–µ—Ä—Å–∏—è:** 2.4.2
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û**

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞:

```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –í–°–ï–• –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –±–æ—Ç–∞
pkill -9 -f "python3 apps/bot/main.py"

# 2. –ü–æ–¥–æ–∂–¥–∞—Ç—å 10 —Å–µ–∫—É–Ω–¥ (Telegram –¥–æ–ª–∂–µ–Ω –æ—Å–≤–æ–±–æ–¥–∏—Ç—å —Å–µ—Å—Å–∏—é)
sleep 10

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –¢–û–õ–¨–ö–û –û–î–ò–ù —ç–∫–∑–µ–º–ø–ª—è—Ä
source venv/bin/activate
PYTHONPATH=/Users/new/Desktop/–ü—Ä–æ–µ–∫—Ç—ã/Monster/Monster-Triborg:$PYTHONPATH python3 apps/bot/main.py
```

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∑–∞–ø—É—â–µ–Ω **—Ç–æ–ª—å–∫–æ –û–î–ò–ù** —ç–∫–∑–µ–º–ø–ª—è—Ä –±–æ—Ç–∞!

–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫—É:
```
TelegramConflictError: Conflict: terminated by other getUpdates request
```

–≠—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –≥–¥–µ-—Ç–æ –µ—â–µ –∑–∞–ø—É—â–µ–Ω –±–æ—Ç (–¥—Ä—É–≥–æ–π —Ç–µ—Ä–º–∏–Ω–∞–ª/—Å–µ—Ä–≤–µ—Ä). –ù–∞–π–¥–∏—Ç–µ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –µ–≥–æ.

---

## üìö –°–≤—è–∑–∞–Ω–Ω–∞—è –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `CONTACT_COLLECTION_FEATURE.md` - –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è (v2.4.0)
- `BUGFIX_FOLLOWUP_STATE.md` - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ "–∑–∞–ª–∏–ø–∞–Ω–∏—è" (v2.4.1)
- `DEEP_LINK_URLS.md` - Deep Link —Å—Å—ã–ª–∫–∏
- `VERSION_2.4.1_SUMMARY.md` - –û–±–∑–æ—Ä –≤–µ—Ä—Å–∏–∏

---

## ‚úÖ –°—Ç–∞—Ç—É—Å

**–ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–∞!**

**–ö–ª—é—á–µ–≤–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω—ã —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ë–ï–ó —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—é FSM.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –í—Å–µ Inline-–∫–Ω–æ–ø–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ "–ß–∞—Å–∏–∫–∏" –ø—Ä–æ–ø–∞–¥–∞—é—Ç
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞–∂–∞—Ç–∏—è
- ‚úÖ –í–æ—Ä–æ–Ω–∫–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
