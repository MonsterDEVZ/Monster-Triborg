# üêõ Bugfix: –≠–∫—Å–ø—Ä–µ—Å—Å-–ó–∞–∫–∞–∑—ã - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

## üìã –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤–æ—Ä–æ–Ω–∫—É –¥–ª—è **Monster Express** (–∏ **Monster CG**) –±–æ—Ç –≤—ã–¥–∞–≤–∞–ª –æ—à–∏–±–∫—É:

```
TelegramBadRequest: Telegram server says - Bad Request: failed to get HTTP URL content
TelegramBadRequest: Telegram server says - Bad Request: wrong type of the web page content
```

**–ü—Ä–∏—á–∏–Ω–∞:** URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π `CG_Cover.jpg` –∏ `Express_Cover.jpg` –Ω–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª–∏ –Ω–∞ Cloudflare R2 CDN.

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –î–æ–±–∞–≤–ª–µ–Ω Fallback –ú–µ—Ö–∞–Ω–∏–∑–º

**–§–∞–π–ª:** `packages/core/handlers/start.py` (—Å—Ç—Ä–æ–∫–∏ 109-121)

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–ª–µ–Ω try/except –±–ª–æ–∫ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:

```python
# –ü—ã—Ç–∞–µ–º—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ, –µ—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è - –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç
try:
    await bot.send_photo(
        chat_id=message.chat.id,
        photo=photo_url,
        caption=caption,
        reply_markup=keyboard,
    )
except Exception as e:
    # Fallback: –µ—Å–ª–∏ —Ñ–æ—Ç–æ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    await message.answer(
        text=caption,
        reply_markup=keyboard,
    )
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ë–æ—Ç –Ω–µ –ø–∞–¥–∞–µ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Å–µ–≥–¥–∞ –ø–æ–ª—É—á–∞–µ—Ç –≤–æ—Ä–æ–Ω–∫—É (—Å —Ñ–æ—Ç–æ –∏–ª–∏ –±–µ–∑)
- ‚úÖ –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã

---

### 2. –í—Ä–µ–º–µ–Ω–Ω–æ–µ –†–µ—à–µ–Ω–∏–µ: –û–¥–Ω–æ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –í—Å–µ—Ö

**–§–∞–π–ª:** `locales/locales.json` (—Å—Ç—Ä–æ–∫–∏ 57, 91)

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:**
–í—Ä–µ–º–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–∞–±–æ—á–∏–π URL `Cover.jpg` –¥–ª—è –≤—Å–µ—Ö —Ç—Ä–µ—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π:

```json
{
  "agency": {
    "photo_url": "https://pub-68f0f95cdc3344e2b4ff5ce24184f710.r2.dev/Cover.jpg"
  },
  "cg": {
    "photo_url": "https://pub-68f0f95cdc3344e2b4ff5ce24184f710.r2.dev/Cover.jpg"  // ‚Üê –í—Ä–µ–º–µ–Ω–Ω–æ
  },
  "express": {
    "photo_url": "https://pub-68f0f95cdc3344e2b4ff5ce24184f710.r2.dev/Cover.jpg"  // ‚Üê –í—Ä–µ–º–µ–Ω–Ω–æ
  }
}
```

**–ë—ã–ª–æ (–æ—à–∏–±–∫–∞):**
```json
"cg": {
  "photo_url": "https://pub-68f0f95cdc3344e2b4ff5ce24184f710.r2.dev/CG_Cover.jpg"  // ‚ùå –ù–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
}
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### ‚úÖ –¢–µ—Å—Ç 1: Monster Express (Deep Link)

```
–û—Ç–∫—Ä–æ–π—Ç–µ: https://t.me/monstrassistentbot?start=express
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (Cover.jpg)
- ‚úÖ –ü–æ–¥–ø–∏—Å—å: "Monster Express. –†–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî –≤—á–µ—Ä–∞..."
- ‚úÖ –¢—Ä–∏ –∫–Ω–æ–ø–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ **–ù–ï–¢ –æ—à–∏–±–æ–∫**

---

### ‚úÖ –¢–µ—Å—Ç 2: Monster CG (Deep Link)

```
–û—Ç–∫—Ä–æ–π—Ç–µ: https://t.me/monstrassistentbot?start=cg
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (Cover.jpg)
- ‚úÖ –ü–æ–¥–ø–∏—Å—å: "–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é. –≠—Ç–æ Monster CG..."
- ‚úÖ –¢—Ä–∏ –∫–Ω–æ–ø–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ **–ù–ï–¢ –æ—à–∏–±–æ–∫**

---

### ‚úÖ –¢–µ—Å—Ç 3: Fallback Menu ‚Üí Express

```
1. –û—Ç–∫—Ä–æ–π—Ç–µ: https://t.me/monstrassistentbot
2. –í—ã–±–µ—Ä–∏—Ç–µ: "üöÄ –≠–∫—Å–ø—Ä–µ—Å—Å-–∑–∞–∫–∞–∑—ã"
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
- ‚úÖ –í–æ—Ä–æ–Ω–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ **–ù–ï–¢ –æ—à–∏–±–æ–∫**

---

## üìä –°—Ç–∞—Ç—É—Å

**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```
‚ùå Express: –û—à–∏–±–∫–∞ TelegramBadRequest
‚ùå CG: –û—à–∏–±–∫–∞ TelegramBadRequest
‚úÖ Agency: –†–∞–±–æ—Ç–∞–µ—Ç
```

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```
‚úÖ Express: –†–∞–±–æ—Ç–∞–µ—Ç (—Å Cover.jpg)
‚úÖ CG: –†–∞–±–æ—Ç–∞–µ—Ç (—Å Cover.jpg)
‚úÖ Agency: –†–∞–±–æ—Ç–∞–µ—Ç (—Å Cover.jpg)
```

---

## üîß –°–ª–µ–¥—É—é—â–∏–µ –®–∞–≥–∏

### –î–ª—è –ü–æ–ª–Ω–æ–≥–æ –†–µ—à–µ–Ω–∏—è:

1. **–ó–∞–≥—Ä—É–∑–∏—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è** –Ω–∞ Cloudflare R2:
   - `CG_Cover.jpg` –¥–ª—è Monster CG
   - `Express_Cover.jpg` –¥–ª—è Monster Express

2. **–û–±–Ω–æ–≤–∏—Ç–µ `locales/locales.json`:**
   ```json
   "cg": {
     "photo_url": "https://pub-68f0f95cdc3344e2b4ff5ce24184f710.r2.dev/CG_Cover.jpg"
   },
   "express": {
     "photo_url": "https://pub-68f0f95cdc3344e2b4ff5ce24184f710.r2.dev/Express_Cover.jpg"
   }
   ```

3. **–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ù–ï —Ç—Ä–µ–±—É–µ—Ç—Å—è** ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–∏—Ç–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏

---

## üõ°Ô∏è Fallback –ú–µ—Ö–∞–Ω–∏–∑–º

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:

```
–ü–æ–ø—ã—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ
    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ send_photo‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
      ‚îÇ
      ‚îú‚îÄ‚Üí ‚úÖ –£—Å–ø–µ—Ö: –§–æ—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ
      ‚îÇ
      ‚îî‚îÄ‚Üí ‚ùå –û—à–∏–±–∫–∞: Fallback
              ‚Üì
          message.answer()
          (—Ç–µ–∫—Å—Ç –±–µ–∑ —Ñ–æ—Ç–æ)
```

### –ö–æ–≥–¥–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç Fallback:
- URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- –§–∞–π–ª –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
- –ü—Ä–µ–≤—ã—à–µ–Ω —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (>20 MB)
- –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é
- –õ—é–±–∞—è –¥—Ä—É–≥–∞—è –æ—à–∏–±–∫–∞ Telegram API

---

## üìù –õ–æ–≥–∏

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
2025-10-24 20:56:26,508 - aiogram.event - ERROR - Cause exception while process update
TelegramBadRequest: Telegram server says - Bad Request: failed to get HTTP URL content
  File "start.py", line 109, in start_funnel
    await bot.send_photo(...)
```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
2025-10-24 20:57:43,213 - __main__ - INFO - üöÄ Monster Triborg Bot –∑–∞–ø—É—â–µ–Ω!
2025-10-24 20:57:43,713 - aiogram.dispatcher - INFO - Run polling for bot @monstrassistentbot
‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫
```

---

## ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ –§–∞–π–ª—ã

| –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏–µ | –°—Ç—Ä–æ–∫–∏ |
|------|-----------|--------|
| `packages/core/handlers/start.py` | –î–æ–±–∞–≤–ª–µ–Ω try/except –¥–ª—è send_photo | 109-121 |
| `locales/locales.json` | CG: –∏–∑–º–µ–Ω–µ–Ω URL –Ω–∞ Cover.jpg | 57 |
| `locales/locales.json` | Express: –∏–∑–º–µ–Ω–µ–Ω URL –Ω–∞ Cover.jpg | 91 |
| `BUGFIX_EXPRESS.md` | –°–æ–∑–¥–∞–Ω (—ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç) | NEW |

---

## üéØ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –£—Å–ø–µ—Ö–∞

- [x] –ë–æ—Ç –Ω–µ –ø–∞–¥–∞–µ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- [x] Express —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [x] CG —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [x] Agency —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [x] Fallback –º–µ—Ö–∞–Ω–∏–∑–º —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞

---

## üöÄ –°—Ç–∞—Ç—É—Å

**–í–µ—Ä—Å–∏—è:** 2.3.1 (Bugfix: Express & CG Images)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û**
**–î–∞—Ç–∞:** 2025-10-24

---

## üìö –°–≤—è–∑–∞–Ω–Ω–∞—è –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `VISUAL_UPGRADE.md` - –ò—Å—Ö–æ–¥–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- `VISUAL_TEST_CHECKLIST.md` - –ß–µ–∫–ª–∏—Å—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- `README.md` - –û–±—â–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

---

**–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞! –í—Å–µ –≤–æ—Ä–æ–Ω–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.** ‚úÖ
