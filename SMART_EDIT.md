# üéØ Smart Edit - –£–º–Ω–æ–µ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ó–∞—è–≤–æ–∫

## üìã –û–±–∑–æ—Ä

**Smart Edit** ‚Äî —ç—Ç–æ —É–ª—É—á—à–µ–Ω–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ follow-up —Å–æ–æ–±—â–µ–Ω–∏–π –≤ Monster Triborg Bot v2.2, –∫–æ—Ç–æ—Ä—ã–π **—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ª–∏–¥–µ** –≤–º–µ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π.

### –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:

**–ë–´–õ–û (v2.1):**
```
[–°–æ–æ–±—â–µ–Ω–∏–µ 1] ‚ö†Ô∏è [FALLBACK - CRM –ù–ï–î–û–°–¢–£–ü–ù–ê]
               –ù–æ–≤—ã–π –ª–∏–¥ –æ—Ç @username...

[–°–æ–æ–±—â–µ–Ω–∏–µ 2] üìé FOLLOW-UP –æ—Ç @username (AGENCY):
               https://example.com
```
‚ùå –î–≤–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è ‚Üí –º–µ–Ω–µ–¥–∂–µ—Ä –¥–æ–ª–∂–µ–Ω —Å–æ–ø–æ—Å—Ç–∞–≤–ª—è—Ç—å –∏—Ö –≤—Ä—É—á–Ω—É—é

**–°–¢–ê–õ–û (v2.2 —Å Smart Edit):**
```
[–°–æ–æ–±—â–µ–Ω–∏–µ 1] ‚úÖ –û–ë–ù–û–í–õ–ï–ù–û: –°–°–´–õ–ö–ê –ü–û–õ–£–ß–ï–ù–ê!

               ‚ö†Ô∏è [FALLBACK - CRM –ù–ï–î–û–°–¢–£–ü–ù–ê]
               –ù–æ–≤—ã–π –ª–∏–¥ –æ—Ç @username...

               üìé FOLLOW-UP:
               –°–æ–æ–±—â–µ–Ω–∏–µ: https://example.com
```
‚úÖ –û–¥–Ω–æ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Üí –≤—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ

---

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

### –î–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞:
- ‚úÖ **–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ –æ–¥–Ω–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏** ‚Äî –Ω–µ –Ω—É–∂–Ω–æ –∏—Å–∫–∞—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- ‚úÖ **–í–∏–∑—É–∞–ª—å–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** ‚Äî "‚úÖ –û–ë–ù–û–í–õ–ï–ù–û: –°–°–´–õ–ö–ê –ü–û–õ–£–ß–ï–ù–ê!"
- ‚úÖ **–ß–∏—Å—Ç–∞—è –∏—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞** ‚Äî –º–µ–Ω—å—à–µ —Å–ø–∞–º–∞, –±–æ–ª—å—à–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- ‚úÖ **HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî –∂–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç, –∫—É—Ä—Å–∏–≤ –¥–ª—è –≤–∞–∂–Ω—ã—Ö –ø–æ–ª–µ–π

### –î–ª—è —Å–∏—Å—Ç–µ–º—ã:
- ‚úÖ **–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å** ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ fallback (–∫–æ–≥–¥–∞ –µ—Å—Ç—å Message ID)
- ‚úÖ **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** ‚Äî –µ—Å–ª–∏ Message ID –Ω–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞
- ‚úÖ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤** ‚Äî –¥–æ–∫—É–º–µ–Ω—Ç—ã/—Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ –ø–µ—Ä–µ—Å—ã–ª–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –§–∞–∑–∞ 1: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ Message ID

**–§–∞–π–ª:** `packages/core/handlers/callbacks.py` (lines 75, 105-112, 154-159)

```python
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è Message ID
admin_message_id = None

# –û—Ç–ø—Ä–∞–≤–ª—è–µ–º fallback –≤ Telegram
sent_message = await bot.send_message(
    chat_id=config.ADMIN_CHAT_ID,
    text=fallback_message,
    parse_mode="HTML"
)
admin_message_id = sent_message.message_id

# –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ FSM state
await state.update_data(
    profile=profile_name,
    username=username,
    last_choice=choice_text,
    admin_message_id=admin_message_id,  # NEW
)
```

**–ö–æ–≥–¥–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è Message ID:**
- ‚úÖ Fallback –≤ Telegram (AmoCRM –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞)
- ‚úÖ Webhook –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚ùå –£—Å–ø–µ—à–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ AmoCRM (–Ω–µ –Ω—É–∂–µ–Ω, —Ç.–∫. —Å–¥–µ–ª–∫–∞ –≤ CRM)

---

### –§–∞–∑–∞ 2: –£–º–Ω–æ–µ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–§–∞–π–ª:** `packages/core/handlers/followup.py` (lines 44-117)

```python
# –ü–æ–ª—É—á–∞–µ–º admin_message_id –∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è
admin_message_id = state_data.get("admin_message_id")

# –°–¶–ï–ù–ê–†–ò–ô 1: Message ID –µ—Å—Ç—å ‚Üí —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º
if admin_message_id:
    updated_text = (
        f"‚úÖ <b>–û–ë–ù–û–í–õ–ï–ù–û: –°–°–´–õ–ö–ê –ü–û–õ–£–ß–ï–ù–ê!</b>\n\n"
        # ... –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç ...
        f"üìé <b>FOLLOW-UP:</b>\n"
        f"<b>–°–æ–æ–±—â–µ–Ω–∏–µ:</b> {message.text}\n"
    )

    await bot.edit_message_text(
        chat_id=config.ADMIN_CHAT_ID,
        message_id=admin_message_id,
        text=updated_text,
        parse_mode="HTML"
    )

# –°–¶–ï–ù–ê–†–ò–ô 2: Message ID –Ω–µ—Ç ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ (—Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞)
else:
    followup_text = followup_template.format(...)
    await bot.send_message(
        chat_id=config.ADMIN_CHAT_ID,
        text=followup_text
    )
```

---

### –§–∞–∑–∞ 3: HTML –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ HTML:**
- `<b>–ñ–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç</b>` –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∏ –≤–∞–∂–Ω—ã—Ö –ø–æ–ª–µ–π
- `<i>–ö—É—Ä—Å–∏–≤</i>` –¥–ª—è –ø–æ—è—Å–Ω–µ–Ω–∏–π
- `<code>–ú–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω—ã–π</code>` –¥–ª—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–∏–º–µ—Ä —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è:**

```html
‚úÖ <b>–û–ë–ù–û–í–õ–ï–ù–û: –°–°–´–õ–ö–ê –ü–û–õ–£–ß–ï–ù–ê!</b>

‚ö†Ô∏è <b>[FALLBACK - CRM –ù–ï–î–û–°–¢–£–ü–ù–ê]</b> ‚ö†Ô∏è

üî• <b>–ù–û–í–´–ô –õ–ò–î: MONSTER AGENCY</b> üî•

‚ùóÔ∏è <i>–í–∞–∂–Ω–æ: –≠—Ç–æ—Ç –ª–∏–¥ –ù–ï –±—ã–ª —Å–æ–∑–¥–∞–Ω –≤ AmoCRM –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
–¢—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–æ–µ –≤–Ω–µ—Å–µ–Ω–∏–µ.</i>

<b>--- –î–ê–ù–ù–´–ï –î–õ–Ø CRM ---</b>
<b>–ó–∞–ø—Ä–æ—Å:</b> –ü—Ä–∏–≤–ª–µ—á—å –∫–ª–∏–µ–Ω—Ç–æ–≤
<b>–ö–æ–Ω—Ç–∞–∫—Ç:</b> @betterrman
<b>–ò–º—è:</b> Galliard
<b>--------------------------</b>

üìé <b>FOLLOW-UP:</b>
<b>–°–æ–æ–±—â–µ–Ω–∏–µ:</b> https://example.com
<b>--------------------------</b>

<b>–ó–∞–¥–∞—á–∞:</b>
1. –í–Ω–µ—Å—Ç–∏ –ª–∏–¥ –≤ AmoCRM –≤—Ä—É—á–Ω—É—é.
2. –°–≤—è–∑–∞—Ç—å—Å—è —Å –∫–ª–∏–µ–Ω—Ç–æ–º –≤ Telegram.
```

**–ö–∞–∫ —ç—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç –≤ Telegram:**

- **–ñ–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç** –≤—ã–¥–µ–ª—è–µ—Ç—Å—è –≤–∏–∑—É–∞–ª—å–Ω–æ
- *–ö—É—Ä—Å–∏–≤* –ø—Ä–∏–≤–ª–µ–∫–∞–µ—Ç –≤–Ω–∏–º–∞–Ω–∏–µ –∫ –≤–∞–∂–Ω—ã–º –ø–æ—è—Å–Ω–µ–Ω–∏—è–º
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ª–µ–≥–∫–æ —á–∏—Ç–∞–µ—Ç—Å—è

---

## üîÑ –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: AmoCRM –¥–æ—Å—Ç—É–ø–Ω–∞ (–±–µ–∑ Smart Edit)

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É
2. –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ AmoCRM ‚Üí ‚úÖ –£—Å–ø–µ—à–Ω–æ
3. admin_message_id = None (–Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è)
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Å—ã–ª–∫—É
5. Follow-up ‚Üí –æ—Ç–¥–µ–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram
```

**–ü–æ—á–µ–º—É —Ç–∞–∫?** –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —É–∂–µ –≤ AmoCRM, follow-up ‚Äî –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ.

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: AmoCRM –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ (Smart Edit –∞–∫—Ç–∏–≤–µ–Ω)

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É
2. –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ AmoCRM ‚Üí ‚ùå –û—à–∏–±–∫–∞
3. Fallback –≤ Telegram ‚Üí admin_message_id = 12345
4. admin_message_id —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ FSM state
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Å—ã–ª–∫—É
6. –ë–æ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ 12345 ‚Üí –¥–æ–±–∞–≤–ª—è–µ—Ç follow-up
```

**–ü–æ—á–µ–º—É —Ç–∞–∫?** –í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ª–∏–¥–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ.

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: Webhook –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω (Smart Edit –∞–∫—Ç–∏–≤–µ–Ω)

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É
2. Webhook URL –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
3. Fallback –≤ Telegram ‚Üí admin_message_id = 67890
4. admin_message_id —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ FSM state
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Å—ã–ª–∫—É
6. –ë–æ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ 67890 ‚Üí –¥–æ–±–∞–≤–ª—è–µ—Ç follow-up
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ Smart Edit –ø—Ä–∏ fallback

**–®–∞–≥–∏:**

1. –í—Ä–µ–º–µ–Ω–Ω–æ –∏–∑–º–µ–Ω–∏—Ç–µ webhook URL –Ω–∞ –Ω–µ–≤–µ—Ä–Ω—ã–π –≤ `locales/locales.json`:
   ```json
   {
     "agency": {
       "webhook_url": "https://INVALID_URL_FOR_TESTING/webhook"
     }
   }
   ```

2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:
   ```bash
   ./run.sh
   ```

3. –û—Ç–∫—Ä–æ–π—Ç–µ: https://t.me/monstrassistentbot?start=agency

4. –ù–∞–∂–º–∏—Ç–µ –ª—é–±—É—é –∫–Ω–æ–ø–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ü—Ä–∏–≤–ª–µ—á—å –∫–ª–∏–µ–Ω—Ç–æ–≤")

5. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Telegram (ADMIN_CHAT_ID):**
   - ‚úÖ –î–æ–ª–∂–Ω–æ –ø—Ä–∏–π—Ç–∏ fallback —Å–æ–æ–±—â–µ–Ω–∏–µ —Å HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
   - ‚úÖ –ñ–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
   - ‚úÖ –ö—É—Ä—Å–∏–≤ –¥–ª—è –≤–∞–∂–Ω—ã—Ö –ø–æ—è—Å–Ω–µ–Ω–∏–π

6. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É —Å—Å—ã–ª–∫—É: `https://example.com`

7. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Telegram:**
   - ‚úÖ –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –†–ï–î–ê–ö–¢–ò–†–£–ï–¢–°–Ø (–Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è –Ω–æ–≤–æ–µ)
   - ‚úÖ –í –Ω–∞—á–∞–ª–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è: "‚úÖ –û–ë–ù–û–í–õ–ï–ù–û: –°–°–´–õ–ö–ê –ü–û–õ–£–ß–ï–ù–ê!"
   - ‚úÖ –í –∫–æ–Ω—Ü–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —Å–µ–∫—Ü–∏—è "üìé FOLLOW-UP:"
   - ‚úÖ –í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ –æ–¥–Ω–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏

---

### –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤

**–®–∞–≥–∏:**

1. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –¢–µ—Å—Ç 1 (—à–∞–≥–∏ 1-5)

2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É —Ñ–∞–π–ª (PDF, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –≤–∏–¥–µ–æ)

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Telegram:**
   - ‚úÖ –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç—Å—è —Å —Ç–µ–∫—Å—Ç–æ–º "‚úÖ –û–ë–ù–û–í–õ–ï–ù–û"
   - ‚úÖ –û—Ç–¥–µ–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: "üìé –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –æ—Ç @username:"
   - ‚úÖ –§–∞–π–ª –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∏–∂–µ

---

### –¢–µ—Å—Ç 3: –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å (–±–µ–∑ Message ID)

**–£—Å–ª–æ–≤–∏—è:** AmoCRM –¥–æ—Å—Ç—É–ø–Ω–∞ ‚Üí —Å–¥–µ–ª–∫–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è —É—Å–ø–µ—à–Ω–æ ‚Üí admin_message_id = None

**–®–∞–≥–∏:**

1. –í–µ—Ä–Ω–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π webhook URL –≤ `locales/locales.json`

2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞

3. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É ‚Üí —Å–¥–µ–ª–∫–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è –≤ AmoCRM

4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É

5. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Telegram:**
   - ‚úÖ –ù–æ–≤–æ–µ –æ—Ç–¥–µ–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å follow-up (—Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞)
   - ‚úÖ –§–æ—Ä–º–∞—Ç: "üìé FOLLOW-UP –æ—Ç @username (AGENCY): ..."

**–ü–æ—á–µ–º—É —Ç–∞–∫?** –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —É–∂–µ –≤ AmoCRM, –Ω–µ –Ω—É–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å Telegram.

---

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –£—Å–ø–µ—à–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
```
‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ 12345 —É—Å–ø–µ—à–Ω–æ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–æ —Å follow-up –¥–∞–Ω–Ω—ã–º–∏
```

### –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (fallback):
```
üì§ Follow-up –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º (–Ω–µ—Ç admin_message_id)
```

### –û—à–∏–±–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
```
‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ follow-up: [–¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏]
```

---

## üõ†Ô∏è –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω–∏–π

| –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏—è | –°—Ç—Ä–æ–∫–∏ |
|------|-----------|--------|
| `callbacks.py` | –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ admin_message_id | 75, 109-112, 154-159 |
| `callbacks.py` | HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ fallback | 93-105 |
| `callbacks.py` | HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ webhook-not-configured | 128-130 |
| `followup.py` | –õ–æ–≥–∏–∫–∞ Smart Edit | 44-117 |
| `followup.py` | HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | 47-78 |

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –û—Ç–∫–ª—é—á–µ–Ω–∏–µ Smart Edit

–ï—Å–ª–∏ –≤—ã –ù–ï —Ö–æ—Ç–∏—Ç–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è, –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –≤ `followup.py:44-117`:

```python
# if admin_message_id:
#     # Smart Edit –æ—Ç–∫–ª—é—á—ë–Ω
#     pass
```

–¢–æ–≥–¥–∞ –≤—Å–µ–≥–¥–∞ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞ (–æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è).

---

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è

–ò–∑–º–µ–Ω–∏—Ç–µ –≤ `followup.py:47-70`:

```python
updated_text = (
    f"üéâ <b>–õ–ò–î –û–ë–ù–û–í–õ–Å–ù!</b>\n\n"  # –ù–æ–≤—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫
    # ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç ...
)
```

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —É–ª—É—á—à–µ–Ω–∏—è

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ Smart Edit | –ü–æ—Å–ª–µ Smart Edit | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|---------------|------------------|-----------|
| –°–æ–æ–±—â–µ–Ω–∏–π –Ω–∞ –∑–∞—è–≤–∫—É | 2 (–æ—Å–Ω–æ–≤–Ω–æ–µ + follow-up) | 1 (—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ) | **-50%** |
| –í—Ä–µ–º—è –ø–æ–∏—Å–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ | ~10 —Å–µ–∫ | ~2 —Å–µ–∫ | **-80%** |
| –í–∏–∑—É–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ | –°–ª–∞–±–∞—è | –û—Ç–ª–∏—á–Ω–∞—è (HTML) | **+100%** |
| –†–∏—Å–∫ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö | –°—Ä–µ–¥–Ω–∏–π | –ù–∏–∑–∫–∏–π | **-50%** |

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

- [x] –§–∞–∑–∞ 1: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ Message ID –≤ callbacks.py
- [x] –§–∞–∑–∞ 2: –õ–æ–≥–∏–∫–∞ Smart Edit –≤ followup.py
- [x] –§–∞–∑–∞ 3: HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- [x] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- [x] –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å (—Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ Message ID)
- [x] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

---

## üéØ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: Monster Agency

**–î–æ:**
```
[–°–æ–æ–±—â–µ–Ω–∏–µ 1] ‚ö†Ô∏è [FALLBACK - CRM –ù–ï–î–û–°–¢–£–ü–ù–ê]
               –ù–æ–≤—ã–π –ª–∏–¥: MONSTER AGENCY
               –ó–∞–ø—Ä–æ—Å: –ü—Ä–∏–≤–ª–µ—á—å –∫–ª–∏–µ–Ω—Ç–æ–≤
               @betterrman

[–°–æ–æ–±—â–µ–Ω–∏–µ 2] üìé FOLLOW-UP –æ—Ç @betterrman (AGENCY):
               https://mycompany.com
```

**–ü–æ—Å–ª–µ:**
```
[–°–æ–æ–±—â–µ–Ω–∏–µ 1 - –æ–±–Ω–æ–≤–ª–µ–Ω–æ]
‚úÖ –û–ë–ù–û–í–õ–ï–ù–û: –°–°–´–õ–ö–ê –ü–û–õ–£–ß–ï–ù–ê!

‚ö†Ô∏è [FALLBACK - CRM –ù–ï–î–û–°–¢–£–ü–ù–ê]
–ù–æ–≤—ã–π –ª–∏–¥: MONSTER AGENCY
–ó–∞–ø—Ä–æ—Å: –ü—Ä–∏–≤–ª–µ—á—å –∫–ª–∏–µ–Ω—Ç–æ–≤
–ö–æ–Ω—Ç–∞–∫—Ç: @betterrman

üìé FOLLOW-UP:
–°–æ–æ–±—â–µ–Ω–∏–µ: https://mycompany.com
```

---

### –ü—Ä–∏–º–µ—Ä 2: Monster CG

**–î–æ:**
```
[–°–æ–æ–±—â–µ–Ω–∏–µ 1] –ù–æ–≤—ã–π –ª–∏–¥: MONSTER CG
               –ó–∞–ø—Ä–æ—Å: AI-–≤–∏–¥–µ–æ
               @username

[–°–æ–æ–±—â–µ–Ω–∏–µ 2] FOLLOW-UP –æ—Ç @username (CG):
               https://youtube.com/watch?v=example
```

**–ü–æ—Å–ª–µ:**
```
[–°–æ–æ–±—â–µ–Ω–∏–µ 1 - –æ–±–Ω–æ–≤–ª–µ–Ω–æ]
‚úÖ –û–ë–ù–û–í–õ–ï–ù–û: –°–°–´–õ–ö–ê –ü–û–õ–£–ß–ï–ù–ê!

–ù–æ–≤—ã–π –ª–∏–¥: MONSTER CG
–ó–∞–ø—Ä–æ—Å: AI-–≤–∏–¥–µ–æ
–ö–æ–Ω—Ç–∞–∫—Ç: @username

üìé FOLLOW-UP:
–°–æ–æ–±—â–µ–Ω–∏–µ: https://youtube.com/watch?v=example
```

---

## üöÄ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### –í–æ–∑–º–æ–∂–Ω—ã–µ —Ñ–∏—á–∏:

1. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö follow-up —Å–æ–æ–±—â–µ–Ω–∏–π
2. **–¢–∞–π–º-—Å—Ç–µ–º–ø—ã** ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ follow-up
3. **–°—Ç–∞—Ç—É—Å—ã** ‚Äî "üì• –ü–æ–ª—É—á–µ–Ω–æ", "üëÅ –ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ", "‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ"
4. **–ö–Ω–æ–ø–∫–∏ –±—ã—Å—Ç—Ä—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π** ‚Äî Inline-–∫–Ω–æ–ø–∫–∏ –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞

---

## üìö –°–≤—è–∑–∞–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `FALLBACK_MECHANISM.md` ‚Äî –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–∞—è —Å–∏—Å—Ç–µ–º–∞
- `AMOCRM_INTEGRATION.md` ‚Äî –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å AmoCRM
- `README.md` ‚Äî –û–±—â–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `DEVELOPER_NOTES.md` ‚Äî –ó–∞–º–µ—Ç–∫–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-10-24
**–í–µ—Ä—Å–∏—è:** 2.2 (Smart Edit)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Production Ready
